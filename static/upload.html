<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>局域网文件快传</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#0FC6C2',
                        accent: '#722ED1',
                        success: '#00B42A',
                        warning: '#FF7D00',
                        danger: '#F53F3F',
                        dark: '#1D2129',
                        'dark-2': '#4E5969',
                        'light-1': '#F2F3F5',
                        'light-2': '#E5E6EB',
                        'light-3': '#C9CDD4',
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    boxShadow: {
                        'card': '0 10px 30px -5px rgba(0, 0, 0, 0.1)',
                        'hover': '0 20px 40px -5px rgba(22, 93, 255, 0.15)',
                    }
                },
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .transition-custom {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .scale-hover {
                transition: transform 0.3s ease;
            }
            .scale-hover:hover {
                transform: scale(1.02);
            }
            .progress-animation {
                transition: width 0.5s ease-in-out;
            }
            .upload-drop-zone {
                border: 2px dashed #C9CDD4;
                border-radius: 12px;
                transition: all 0.3s ease;
            }
            .upload-drop-zone.active {
                border-color: #165DFF;
                background-color: rgba(22, 93, 255, 0.05);
            }
        }
    </style>
</head>
<body class="font-inter bg-gray-50 min-h-screen flex flex-col">
    <!-- 导航栏 -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-cloud-upload text-primary text-2xl"></i>
                <h1 class="text-xl font-bold text-dark">局域网文件快传</h1>
            </div>
            <div class="flex items-center space-x-4">
                <div class="md:flex items-center space-x-2 text-dark-2">
                    <!-- <i class="fa fa-info-circle"></i> -->
                    <a id="upload-btn" href="/" class="upload-btn">
                        <i class="fas fa-file"></i>
                        全部文件
                    </a>
                </div>
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-100 transition-custom">
                    <i class="fa fa-moon-o text-dark-2"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="flex-grow container mx-auto px-4 py-8">
        <!-- 欢迎信息 -->
        <section class="mb-8 text-center">
            <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-dark mb-3">上传共享文件</h2>
            <p class="text-dark-2 max-w-2xl mx-auto">将需要共享文件上传到这台计算机。支持拖拽上传、多文件上传和断点续传。</p>
        </section>

        <!-- 文件上传区域 -->
        <section class="max-w-3xl mx-auto mb-12">
            <div id="drop-zone" class="upload-drop-zone p-8 text-center cursor-pointer mb-6">
                <div class="flex flex-col items-center">
                    <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mb-4">
                        <i class="fa fa-cloud-upload text-primary text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-dark mb-2">拖放文件到此处上传</h3>
                    <p class="text-dark-2 mb-6">或者</p>
                    <label for="file-input" class="bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-lg font-medium transition-custom flex items-center">
                        <i class="fa fa-plus mr-2"></i>
                        选择文件上传
                    </label>
                    <input id="file-input" type="file" multiple class="hidden">
                    <p class="text-xs text-dark-2 mt-4">支持的格式: 所有文件类型，最大文件大小: 无限制</p>
                </div>
            </div>

            <!-- 文件列表 -->
            <div id="file-list" class="space-y-4">
                <!-- 文件项将通过JavaScript动态添加 -->
            </div>
        </section>

        <!-- 上传统计 -->
        <section class="max-w-3xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
            <div class="bg-white rounded-xl p-6 shadow-card scale-hover">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-dark font-semibold">今日上传</h3>
                    <div class="w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center">
                        <i class="fa fa-upload text-primary"></i>
                    </div>
                </div>
                <p class="text-3xl font-bold text-dark" id="upload-count">0</p>
                <p class="text-sm text-dark-2">个文件</p>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-card scale-hover">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-dark font-semibold">总上传大小</h3>
                    <div class="w-10 h-10 bg-secondary/10 rounded-full flex items-center justify-center">
                        <i class="fa fa-database text-secondary"></i>
                    </div>
                </div>
                <p class="text-3xl font-bold text-dark" id="upload-size">0 MB</p>
                <p class="text-sm text-dark-2">已上传</p>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-card scale-hover">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-dark font-semibold">上传速度</h3>
                    <div class="w-10 h-10 bg-accent/10 rounded-full flex items-center justify-center">
                        <i class="fa fa-tachometer text-accent"></i>
                    </div>
                </div>
                <p class="text-3xl font-bold text-dark" id="upload-speed">0 KB/s</p>
                <p class="text-sm text-dark-2">当前速度</p>
            </div>
        </section>

        <!-- 最近上传 -->
        <section class="max-w-3xl mx-auto mb-12">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-dark">最近上传</h3>
                <button id="clear-history" class="text-danger hover:text-danger/80 text-sm font-medium transition-custom flex items-center">
                    <i class="fa fa-trash-o mr-1"></i>
                    清空历史
                </button>
            </div>
            <div id="history-list" class="space-y-3">
                <!-- 历史记录将通过JavaScript动态添加 -->
                <div class="text-center text-dark-2 py-8">
                    <i class="fa fa-clock-o text-3xl mb-3 text-light-3"></i>
                    <p>暂无上传历史</p>
                </div>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="bg-white border-t border-light-2 py-6">
        <div class="container mx-auto px-4 text-center text-dark-2 text-sm">
            <p>© 2025 心悦科技 </p>
        </div>
    </footer>

    <!-- 通知组件 -->
    <div id="notification-container" class="fixed top-4 right-4 z-50 flex flex-col space-y-3 w-80"></div>

    <script>
        // 全局变量
        const fileList = document.getElementById('file-list');
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const historyList = document.getElementById('history-list');
        const uploadCount = document.getElementById('upload-count');
        const uploadSize = document.getElementById('upload-size');
        const uploadSpeed = document.getElementById('upload-speed');
        const clearHistoryBtn = document.getElementById('clear-history');
        const ipAddressElement = document.getElementById('ip-address');
        const themeToggle = document.getElementById('theme-toggle');
        const notificationContainer = document.getElementById('notification-container');

        // 上传服务器地址
        const UPLOAD_URL = '/api/upload';

        // 初始化上传统计
        let totalUploads = 0;
        let totalSize = 0;
        let currentSpeed = 0;

        // 获取IP地址
        fetch('/get-ip')
            .then(response => response.json())
            .then(data => {
                ipAddressElement.textContent = `上传地址: http://${data.ip}:8000`;
            })
            .catch(error => {
                console.error('获取IP地址失败:', error);
                ipAddressElement.textContent = '无法获取IP地址，请确保网络连接正常';
                ipAddressElement.classList.add('text-danger');
            });

        // 主题切换
        let isDarkMode = false;
        themeToggle.addEventListener('click', () => {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('bg-gray-900', isDarkMode);
            document.body.classList.toggle('text-white', isDarkMode);
            themeToggle.innerHTML = isDarkMode ? 
                '<i class="fa fa-sun-o text-yellow-400"></i>' : 
                '<i class="fa fa-moon-o text-dark-2"></i>';
            
            // 更新卡片样式
            const cards = document.querySelectorAll('.bg-white');
            cards.forEach(card => {
                card.classList.toggle('bg-gray-800', isDarkMode);
                card.classList.toggle('bg-white', !isDarkMode);
            });
            
            // 更新文本颜色
            const darkTexts = document.querySelectorAll('.text-dark');
            darkTexts.forEach(text => {
                text.classList.toggle('text-white', isDarkMode);
                text.classList.toggle('text-dark', !isDarkMode);
            });
            
            const dark2Texts = document.querySelectorAll('.text-dark-2');
            dark2Texts.forEach(text => {
                text.classList.toggle('text-gray-300', isDarkMode);
                text.classList.toggle('text-dark-2', !isDarkMode);
            });
        });

        // 拖放事件处理
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, unhighlight, false);
        });

        function highlight() {
            dropZone.classList.add('active');
        }

        function unhighlight() {
            dropZone.classList.remove('active');
        }

        dropZone.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }

        // 文件选择
        fileInput.addEventListener('change', function() {
            handleFiles(this.files);
        });

        // 处理选择的文件
        function handleFiles(files) {
            if (files.length === 0) return;
            
            Array.from(files).forEach(file => {
                // 检查是否已添加相同文件
                const existingFile = Array.from(fileList.children).find(item => 
                    item.getAttribute('data-filename') === file.name && 
                    item.getAttribute('data-size') === file.size.toString()
                );
                
                if (existingFile) {
                    showNotification('文件已添加', '该文件已在上传列表中', 'warning');
                    return;
                }
                
                addFileToQueue(file);
            });
        }

        // 添加文件到上传队列
        function addFileToQueue(file) {
            const fileId = `file-${Date.now()}-${Math.floor(Math.random() * 1000)}`;
            const fileSize = formatFileSize(file.size);
            
            // 创建文件项
            const fileItem = document.createElement('div');
            fileItem.id = fileId;
            fileItem.setAttribute('data-filename', file.name);
            fileItem.setAttribute('data-size', file.size);
            fileItem.className = 'bg-white rounded-xl p-4 shadow-card transition-custom hover:shadow-hover';
            
            // 文件图标
            const fileIcon = getFileIcon(file.name);
            
            // 构建文件项内容
            fileItem.innerHTML = `
                <div class="flex items-start space-x-4">
                    <div class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0">
                        <i class="fa ${fileIcon} text-primary"></i>
                    </div>
                    <div class="flex-grow min-w-0">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="text-dark font-medium truncate">${file.name}</h4>
                            <button class="cancel-upload text-dark-2 hover:text-danger transition-custom">
                                <i class="fa fa-times"></i>
                            </button>
                        </div>
                        <div class="flex justify-between items-center text-sm mb-1">
                            <span class="text-dark-2">${fileSize}</span>
                            <span class="status text-dark-2">等待中</span>
                        </div>
                        <div class="w-full bg-light-2 rounded-full h-2">
                            <div class="progress-bar bg-primary h-2 rounded-full progress-animation" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            `;
            
            // 添加到文件列表
            fileList.appendChild(fileItem);
            
            // 添加上传任务
            queueUpload(fileId, file);
            
            // 更新统计信息
            updateStats();
        }

        // 队列处理上传任务
        let activeUploads = 0;
        const MAX_CONCURRENT_UPLOADS = 3;
        const uploadQueue = [];

        function queueUpload(fileId, file) {
            uploadQueue.push({ fileId, file });
            processUploadQueue();
        }

        async function processUploadQueue() {
            if (uploadQueue.length === 0 || activeUploads >= MAX_CONCURRENT_UPLOADS) return;
            
            const { fileId, file } = uploadQueue.shift();
            activeUploads++;
            
            try {
                await uploadFile(fileId, file);
            } catch (error) {
                console.error('上传失败:', error);
                setFileStatus(fileId, '上传失败', 'danger');
                showNotification('上传失败', `${file.name} 上传失败: ${error.message}`, 'danger');
            } finally {
                activeUploads--;
                processUploadQueue();
            }
        }

        // 实际文件上传
        function uploadFile(fileId, file) {
            return new Promise((resolve, reject) => {
                const fileItem = document.getElementById(fileId);
                if (!fileItem) return resolve();
                
                const progressBar = fileItem.querySelector('.progress-bar');
                const statusElement = fileItem.querySelector('.status');
                const cancelButton = fileItem.querySelector('.cancel-upload');
                
                // 设置初始状态
                setFileStatus(fileId, '准备上传', 'primary');
                
                // 创建表单数据
                const formData = new FormData();
                formData.append('file', file);
                
                // 创建XHR对象
                const xhr = new XMLHttpRequest();
                xhr.open('POST', UPLOAD_URL, true);
                
                // 上传进度
                xhr.upload.addEventListener('progress', (e) => {
                    if (e.lengthComputable) {
                        const percentComplete = (e.loaded / e.total) * 100;
                        progressBar.style.width = `${percentComplete}%`;
                        
                        // 计算上传速度
                        const elapsedTime = (new Date().getTime() - startTime) / 1000; // 秒
                        const uploadedSize = e.loaded;
                        currentSpeed = uploadedSize / elapsedTime / 1024; // KB/s
                        
                        // 更新速度显示
                        uploadSpeed.textContent = `${currentSpeed.toFixed(1)} KB/s`;
                        
                        setFileStatus(fileId, `上传中 ${Math.round(percentComplete)}%`, 'primary');
                    }
                });
                
                // 上传完成
                xhr.addEventListener('load', () => {
                    if (xhr.status === 200) {
                        try {
                            const response = JSON.parse(xhr.responseText);
                            setFileStatus(fileId, '上传完成', 'success');
                            // 添加到历史记录
                            addToHistory(file);
                            // 更新统计
                            totalUploads++;
                            totalSize += file.size;
                            updateStats();
                            // 显示通知
                            showNotification('上传成功', `${file.name} 已成功上传`, 'success');
                            
                            // // 3秒后移除上传项
                            // setTimeout(() => {
                            //     fileItem.classList.add('opacity-0');
                            //     setTimeout(() => fileItem.remove(), 300);
                            // }, 3000);
                            
                            resolve();
                        } catch (parseError) {
                            console.error('解析响应失败:', parseError);
                            setFileStatus(fileId, '上传失败', 'danger');
                            showNotification('上传失败', `${file.name} 上传失败: 服务器响应格式错误`, 'danger');
                            reject(new Error('服务器响应格式错误'));
                        }
                    } else {
                        setFileStatus(fileId, '上传失败', 'danger');
                        showNotification('上传失败', `${file.name} 上传失败: ${xhr.statusText}`, 'danger');
                        reject(new Error(xhr.statusText));
                    }
                });
                
                // 上传错误
                xhr.addEventListener('error', () => {
                    setFileStatus(fileId, '上传失败', 'danger');
                    showNotification('上传失败', `${file.name} 上传失败: 网络错误`, 'danger');
                    reject(new Error('网络错误'));
                });
                
                // 上传取消
                xhr.addEventListener('abort', () => {
                    setFileStatus(fileId, '已取消', 'danger');
                    showNotification('上传已取消', `${file.name} 的上传已取消`, 'info');
                    reject(new Error('上传已取消'));
                });
                
                // 取消上传
                cancelButton.addEventListener('click', () => {
                    xhr.abort();
                    
                    // 从队列中移除（如果还在队列中）
                    const index = uploadQueue.findIndex(item => item.fileId === fileId);
                    if (index !== -1) {
                        uploadQueue.splice(index, 1);
                    }
                    
                    // 3秒后移除上传项
                    setTimeout(() => {
                        fileItem.classList.add('opacity-0');
                        setTimeout(() => fileItem.remove(), 300);
                    }, 1000);
                });
                
                // 开始上传
                let startTime = new Date().getTime();
                xhr.send(formData);
            });
        }

        // 设置文件状态
        function setFileStatus(fileId, statusText, statusClass) {
            const fileItem = document.getElementById(fileId);
            if (!fileItem) return;
            
            const statusElement = fileItem.querySelector('.status');
            statusElement.textContent = statusText;
            statusElement.className = `status text-${statusClass}`;
        }

        // 添加到历史记录
        function addToHistory(file) {
            const fileSize = formatFileSize(file.size);
            const fileIcon = getFileIcon(file.name);
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            
            // 创建历史记录项
            const historyItem = document.createElement('div');
            historyItem.className = 'bg-white rounded-lg p-3 flex items-center justify-between shadow-sm hover:shadow-md transition-custom';
            historyItem.innerHTML = `
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 rounded bg-primary/10 flex items-center justify-center">
                        <i class="fa ${fileIcon} text-primary text-sm"></i>
                    </div>
                    <div class="flex-grow min-w-0">
                        <h4 class="text-dark font-medium text-sm truncate">${file.name}</h4>
                        <p class="text-dark-2 text-xs">${fileSize} • ${timeString}</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <button class="download-history text-dark-2 hover:text-primary transition-custom p-1" title="下载">
                        <i class="fa fa-download"></i>
                    </button>
                    <button class="delete-history text-dark-2 hover:text-danger transition-custom p-1" title="删除">
                        <i class="fa fa-trash-o"></i>
                    </button>
                </div>
            `;
            
            // 如果是第一条记录，清空"暂无上传历史"提示
            if (historyList.querySelector('.text-center')) {
                historyList.innerHTML = '';
            }
            
            // 添加到历史列表开头
            historyList.insertBefore(historyItem, historyList.firstChild);
            
            // 下载按钮事件
            const downloadBtn = historyItem.querySelector('.download-history');
            downloadBtn.addEventListener('click', () => {
                // 下载文件
                window.location.href = `/download/${encodeURIComponent(file.name)}`;
            });
            
            // 删除按钮事件
            const deleteBtn = historyItem.querySelector('.delete-history');
            deleteBtn.addEventListener('click', () => {
                // 从服务器删除文件
                fetch(`/delete/${encodeURIComponent(file.name)}`, { method: 'DELETE' })
                    .then(response => {
                        if (response.ok) {
                            historyItem.classList.add('opacity-0');
                            setTimeout(() => historyItem.remove(), 300);
                            
                            // 如果删除后没有记录了，显示空提示
                            if (historyList.children.length === 0) {
                                historyList.innerHTML = `
                                    <div class="text-center text-dark-2 py-8">
                                        <i class="fa fa-clock-o text-3xl mb-3 text-light-3"></i>
                                        <p>暂无上传历史</p>
                                    </div>
                                `;
                            }
                            
                            showNotification('已删除', `${file.name} 已从服务器删除`, 'info');
                        } else {
                            showNotification('删除失败', `无法删除 ${file.name}`, 'danger');
                        }
                    })
                    .catch(error => {
                        console.error('删除文件失败:', error);
                        showNotification('删除失败', `删除文件时发生错误`, 'danger');
                    });
            });
        }

        // 清空历史记录
        clearHistoryBtn.addEventListener('click', () => {
            if (historyList.querySelector('.text-center')) return;
            
            // 先删除服务器上的所有文件
            fetch('/delete-all', { method: 'DELETE' })
                .then(response => {
                    if (response.ok) {
                        // 添加淡出动画
                        Array.from(historyList.children).forEach(child => {
                            child.classList.add('opacity-0');
                        });
                        
                        // 300ms后清空列表
                        setTimeout(() => {
                            historyList.innerHTML = `
                                <div class="text-center text-dark-2 py-8">
                                    <i class="fa fa-clock-o text-3xl mb-3 text-light-3"></i>
                                    <p>暂无上传历史</p>
                                </div>
                            `;
                        }, 300);
                        
                        showNotification('已清空历史', '所有上传历史记录已被清除', 'info');
                    } else {
                        showNotification('清空失败', '无法清空历史记录', 'danger');
                    }
                })
                .catch(error => {
                    console.error('清空历史失败:', error);
                    showNotification('清空失败', '清空历史记录时发生错误', 'danger');
                });
        });

        // 更新统计信息
        function updateStats() {
            uploadCount.textContent = totalUploads;
            uploadSize.textContent = formatFileSize(totalSize);
        }

        // 格式化文件大小
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // 获取文件图标
        function getFileIcon(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            
            const fileIcons = {
                doc: 'fa-file-word-o',
                docx: 'fa-file-word-o',
                xls: 'fa-file-excel-o',
                xlsx: 'fa-file-excel-o',
                pdf: 'fa-file-pdf-o',
                jpg: 'fa-file-image-o',
                jpeg: 'fa-file-image-o',
                png: 'fa-file-image-o',
                gif: 'fa-file-image-o',
                mp3: 'fa-file-audio-o',
                mp4: 'fa-file-video-o',
                zip: 'fa-file-archive-o',
                rar: 'fa-file-archive-o',
                html: 'fa-file-code-o',
                css: 'fa-file-code-o',
                js: 'fa-file-code-o',
                txt: 'fa-file-text-o'
            };
            
            return fileIcons[ext] || 'fa-file-o';
        }

        // 显示通知
        function showNotification(title, message, type = 'info') {
            // const notificationId = `notification-${Date.now()}`;
            
            // // 创建通知元素
            // const notification = document.createElement('div');
            // notification.id = notificationId;
            // notification.className = `bg-white rounded-lg shadow-lg p-4 flex items-start space-x-3 transform transition-all duration-300 opacity-0 translate-y-2`;
            
            // // 设置通知类型样式
            // let iconClass, borderClass;
            // switch(type) {
            //     case 'success':
            //         iconClass = 'fa-check-circle text-success';
            //         borderClass = 'border-l-4 border-success';
            //         break;
            //     case 'error':
            //     case 'danger':
            //         iconClass = 'fa-exclamation-circle text-danger';
            //         borderClass = 'border-l-4 border-danger';
            //         break;
            //     case 'warning':
            //         iconClass = 'fa-exclamation-triangle text-warning';
            //         borderClass = 'border-l-4 border-warning';
            //         break;
            //     case 'info':
            //     default:
            //         iconClass = 'fa-info-circle text-primary';
            //         borderClass = 'border-l-4 border-primary';
            //         break;
            // }
            
            // notification.classList.add(borderClass);
            
            // // 设置通知内容
            // notification.innerHTML = `
            //     <div class="flex-shrink-0 mt-0.5">
            //         <i class="fa ${iconClass}"></i>
            //     </div>
            //     <div class="flex-grow">
            //         <h4 class="font-medium text-dark">${title}</h4>
            //         <p class="text-sm text-dark-2">${message}</p>
            //     </div>
            //     <button class="close-notification text-dark-2 hover:text-dark transition-custom">
            //         <i class="fa fa-times"></i>
            //     </button>
            // `;
            
            // // 添加到通知容器
            // notificationContainer.appendChild(notification);
            
            // // 显示动画
            // setTimeout(() => {
            //     notification.classList.remove('opacity-0', 'translate-y-2');
            // }, 10);
            
            // // 关闭按钮事件
            // const closeBtn = notification.querySelector('.close-notification');
            // closeBtn.addEventListener('click', () => {
            //     removeNotification(notificationId);
            // });
            
            // // 自动关闭
            // setTimeout(() => {
            //     removeNotification(notificationId);
            // }, 5000);
        }

        // 移除通知
        function removeNotification(notificationId) {
            const notification = document.getElementById(notificationId);
            if (!notification) return;
            
            notification.classList.add('opacity-0', 'translate-y-2');
            setTimeout(() => notification.remove(), 300);
        }

        // 添加页面加载动画
        document.addEventListener('DOMContentLoaded', () => {
            // 显示页面
            document.body.classList.add('opacity-100');
            document.body.classList.remove('opacity-0');
            
            // 显示通知
            // showNotification('欢迎使用', '您可以拖放文件到此处或点击选择文件上传', 'info');
            
            // // 加载历史记录
            // fetch('/history')
            //     .then(response => response.json())
            //     .then(files => {
            //         if (files && files.length > 0) {
            //             historyList.innerHTML = '';
            //             files.forEach(file => {
            //                 addToHistory({
            //                     name: file.name,
            //                     size: file.size
            //                 });
            //             });
            //         }
            //     })
            //     .catch(error => {
            //         console.error('加载历史记录失败:', error);
            //     });
        });
    </script>
</body>
</html>
    